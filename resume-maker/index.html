<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Maker - Professional PDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Times New Roman', serif; }
        .resume-container {
            width: 100%; margin: 0 auto; background: white; padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); line-height: 1.4; font-size: 11pt;
            min-height: 297mm;
        }
        .resume-section-title {
            background-color: #e0e0e0; padding: 4px 8px; margin-top: 15px;
            margin-bottom: 10px; font-weight: bold; border-bottom: 1px solid #ccc;
        }
        .resume-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        .resume-table th, .resume-table td { border: 1px solid #ccc; padding: 6px; text-align: left; }
        .resume-table th { background-color: #f0f0f0; font-weight: bold; }
        .bullet-list { list-style-type: disc; margin-left: 20px; padding-left: 5px; }
        .personal-details-grid { display: grid; grid-template-columns: auto 1fr; gap: 4px 12px; }
        .contact-details-grid { display: grid; grid-template-columns: auto 1fr; gap: 4px 8px; }
        .footer-flex-container { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 30px; }
        .resume-title { text-align: center; font-size: 18pt; font-weight: bold; margin-bottom: 20px; text-decoration: underline; }
        .resume-header { display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: flex-start; margin-bottom: 20px; }
        .header-right { width: 120px; height: 150px; border: 1px solid #ccc; }
        .header-right img { width: 100%; height: 100%; object-fit: cover; }

        @media print {
            .print-hide { display: none !important; }
            .resume-preview-wrapper, .resume-container { box-shadow: none !important; padding: 0 !important; margin: 0 !important; }
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3; border-top: 3px solid #3498db;
            border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite;
            display: inline-block; vertical-align: middle; margin-right: 8px; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .btn-download { background-color: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-download:hover { background-color: #059669; }
        .btn-download:disabled { background-color: #9ca3af; cursor: not-allowed; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <nav class="bg-blue-600 text-white p-4 shadow-md print-hide">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">Resume Maker</h1>
            <div class="space-x-4">
                <a href="#" class="hover:underline">Home</a>
                <a href="#" class="hover:underline">About</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6 p-4">
        <!-- Input Panel -->
        <div class="bg-white p-6 rounded shadow-md print-hide">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2">Fill Your Details</h2>
            <form id="resume-form" class="space-y-4">
                <div>
                    <label class="block font-bold">Full Name</label>
                    <input type="text" id="full-name" class="w-full p-2 border rounded" value="Shreyas D. Rathod">
                </div>
                <div>
                    <label class="block font-bold">Profile Photo</label>
                    <input type="file" id="profile-photo" class="w-full p-2 border rounded" accept="image/*">
                </div>
                <div>
                    <label class="block font-bold">Address</label>
                    <textarea id="address" class="w-full p-2 border rounded" rows="2">At Post Ambajogai, Tal. Ambajogai, Dist. Beed</textarea>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <input type="tel" id="mobile" class="p-2 border rounded" placeholder="Mobile" value="+91-9123456789">
                    <input type="email" id="email" class="p-2 border rounded" placeholder="Email" value="shreyas.rathod@gmail.com">
                </div>
                <div>
                    <label class="block font-bold">Career Objective</label>
                    <textarea id="career-objective" class="w-full p-2 border rounded" rows="3">Aim to be associated with a progressive organization that gives scope to apply my skills...</textarea>
                </div>

                <div class="border-t pt-4">
                    <h3 class="font-bold mb-2">Education & Experience</h3>
                    <button type="button" onclick="addQualificationRow()" class="text-blue-600 text-sm font-bold">+ Add Qualification</button>
                    <div id="academic-qualification-container" class="space-y-2 mt-2"></div>
                </div>

                <div class="border-t pt-4">
                    <label class="block font-bold">Declaration</label>
                    <textarea id="declaration" class="w-full p-2 border rounded">I hereby declare that the above information given by me is true to the best of my knowledge.</textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="place" class="p-2 border rounded" placeholder="Place" value="Ambajogai">
                    <input type="date" id="date" class="p-2 border rounded">
                </div>
            </form>
        </div>

        <!-- Preview & Download -->
        <div class="resume-preview-wrapper">
            <div class="flex justify-between items-center mb-4 print-hide">
                <h2 class="text-xl font-semibold">Live Preview</h2>
                <div class="flex gap-2">
                    <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded font-bold">Print</button>
                    <button id="download-api-btn" onclick="generatePDF()" class="btn-download">
                        <span id="loader" class="loader"></span>
                        <span id="btn-text">Download PDF</span>
                    </button>
                </div>
            </div>

            <div id="resume-preview" class="resume-container">
                <div class="resume-title">RESUME</div>
                <div class="resume-header">
                    <div>
                        <h1 id="preview-name" class="text-3xl font-bold"></h1>
                        <div class="contact-details-grid mt-4">
                            <b>Address:</b> <span id="preview-address"></span>
                            <b>Mobile:</b> <span id="preview-mobile"></span>
                            <b>Email:</b> <span id="preview-email"></span>
                        </div>
                    </div>
                    <div class="header-right" id="photo-box">
                        <img id="preview-photo" src="" alt="">
                    </div>
                </div>

                <div class="resume-section-title">CAREER OBJECTIVE</div>
                <p id="preview-career-objective" class="text-justify"></p>

                <div id="academic-section">
                    <div class="resume-section-title">ACADEMIC QUALIFICATION</div>
                    <table class="resume-table">
                        <thead>
                            <tr><th>Sr.No</th><th>Qualification</th><th>Board/University</th><th>Year</th><th>% / CGPA</th></tr>
                        </thead>
                        <tbody id="preview-academic-tbody"></tbody>
                    </table>
                </div>

                <div class="resume-section-title">DECLARATION</div>
                <p id="preview-declaration" class="italic"></p>

                <div class="footer-flex-container">
                    <div>
                        <p><b>Date:</b> <span id="preview-date"></span></p>
                        <p><b>Place:</b> <span id="preview-place"></span></p>
                    </div>
                    <div><p id="preview-signature" class="font-bold"></p></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update Logic
        const form = document.getElementById('resume-form');
        form.addEventListener('input', updatePreview);

        function updatePreview() {
            document.getElementById('preview-name').innerText = document.getElementById('full-name').value;
            document.getElementById('preview-address').innerText = document.getElementById('address').value;
            document.getElementById('preview-mobile').innerText = document.getElementById('mobile').value;
            document.getElementById('preview-email').innerText = document.getElementById('email').value;
            document.getElementById('preview-career-objective').innerText = document.getElementById('career-objective').value;
            document.getElementById('preview-declaration').innerText = document.getElementById('declaration').value;
            document.getElementById('preview-place').innerText = document.getElementById('place').value;
            document.getElementById('preview-date').innerText = document.getElementById('date').value;
            document.getElementById('preview-signature').innerText = `(${document.getElementById('full-name').value})`;

            updateEducationTable();
        }

        function addQualificationRow(q="", u="", y="", p="") {
            const container = document.getElementById('academic-qualification-container');
            const div = document.createElement('div');
            div.className = "flex gap-1";
            div.innerHTML = `
                <input type="text" placeholder="Degree" class="w-1/4 p-1 border rounded edu-q" value="${q}">
                <input type="text" placeholder="Board" class="w-1/4 p-1 border rounded edu-u" value="${u}">
                <input type="text" placeholder="Year" class="w-1/4 p-1 border rounded edu-y" value="${y}">
                <input type="text" placeholder="%" class="w-1/4 p-1 border rounded edu-p" value="${p}">
            `;
            container.appendChild(div);
            div.addEventListener('input', updatePreview);
            updatePreview();
        }

        function updateEducationTable() {
            const tbody = document.getElementById('preview-academic-tbody');
            tbody.innerHTML = "";
            const qs = document.querySelectorAll('.edu-q');
            const us = document.querySelectorAll('.edu-u');
            const ys = document.querySelectorAll('.edu-y');
            const ps = document.querySelectorAll('.edu-p');

            qs.forEach((q, i) => {
                if(q.value) {
                    tbody.innerHTML += `<tr>
                        <td>${i+1}</td>
                        <td>${q.value}</td>
                        <td>${us[i].value}</td>
                        <td>${ys[i].value}</td>
                        <td>${ps[i].value}</td>
                    </tr>`;
                }
            });
        }

        // Photo Upload
        document.getElementById('profile-photo').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(){
                document.getElementById('preview-photo').src = reader.result;
            }
            reader.readAsDataURL(e.target.files[0]);
        });

        // API PDF Generation
        async function generatePDF() {
            const btn = document.getElementById('download-api-btn');
            const loader = document.getElementById('loader');
            const btnText = document.getElementById('btn-text');

            btn.disabled = true;
            loader.style.display = "inline-block";
            btnText.innerText = "Processing...";

            const resumeHtml = document.getElementById('resume-preview').innerHTML;
            const tailwindStyles = `<script src="https://cdn.tailwindcss.com"><\/script>`;
            
            // पूर्ण HTML डॉक्युमेंट तयार करणे
            const fullHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    ${tailwindStyles}
                    <style>
                        body { font-family: 'Times New Roman', serif; padding: 20px; }
                        .resume-section-title { background-color: #e0e0e0; padding: 4px 8px; margin-top: 15px; font-weight: bold; border-bottom: 1px solid #ccc; -webkit-print-color-adjust: exact; }
                        .resume-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        .resume-table th, .resume-table td { border: 1px solid #ccc; padding: 8px; }
                        .resume-table th { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
                        .resume-header { display: flex; justify-content: space-between; }
                        .header-right { width: 120px; height: 150px; border: 1px solid #ccc; }
                        .header-right img { width: 100%; height: 100%; object-fit: cover; }
                        .resume-title { text-align: center; font-size: 22pt; font-weight: bold; text-decoration: underline; margin-bottom: 20px; }
                        .footer-flex-container { display: flex; justify-content: space-between; margin-top: 40px; }
                    </style>
                </head>
                <body>${resumeHtml}</body>
                </html>
            `;

            try {
                const response = await fetch('resume-maker/api/generate-pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ html: fullHtml })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = "Resume.pdf";
                    a.click();
                } else {
                    alert("PDF Generation Failed");
                }
            } catch (err) {
                console.error(err);
                alert("Server Error");
            } finally {
                btn.disabled = false;
                loader.style.display = "none";
                btnText.innerText = "Download PDF";
            }
        }

        // Initial Data
        window.onload = () => {
            addQualificationRow("SSC", "Maharashtra Board", "2017", "85%");
            addQualificationRow("HSC", "Maharashtra Board", "2019", "70%");
            updatePreview();
        };
    </script>
</body>
</html>
